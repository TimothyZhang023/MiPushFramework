jdk: oraclejdk8
language: android
android:
  components:
  - build-tools-27.0.1
  - android-27
  - extra-android-m2repository
script:
- "./gradlew :app:assembleRelease"
- "./gradlew :push:assembleRelease"
before_install:
- yes | sdkmanager "platforms;android-27"
- openssl aes-256-cbc -K $encrypted_c35c949c40d9_key -iv $encrypted_c35c949c40d9_iv -in .timothy.jks.enc -out .yuuta.jks -d
- chmod +x gradlew
before_deploy:
  - export VERSION=$(git rev-parse --short HEAD)"-SNAPSHOT"
  - mv "app/build/outputs/apk/release/app-release.apk" "app/build/outputs/apk/release/manager.apk"
  - mv "push/build/outputs/apk/release/push-release.apk" "push/build/outputs/apk/release/xmsf_service.apk"
  - git tag $VERSION
deploy:
  name: ${VERSION}
  body: Snapshot version automatically generated by Travis CI, there are some problems, please be cautious experience.
  prerelease: true
  provider: releases
  skip_cleanup: true
  api_key:
    secure: ikfQHKjNHfH/ZUiPSLtXgzwNvT6LI/5IHJW+xTKXh+g1peIVsKbcXPUk2QIwui12xkJaBhzDKbvm7R5frVQEYHREQONneYkIiwq/Oa9It789JAwl1YYScHdcdL7of7wBEaPThY9ILevbIOMPTJKl1ZkIGysehWHDayj4m2zG3q2SFMr437+jvMd4t7rzsmRhzv4kUVKNbN58XWd4B4srvv+BIUYGGypNC63vLzDolMQrLjctr6fsyX3fm3gp7QSzFWy/JlV1q/hla+UCZrFG+S1rOyKLelHPsfpksWvhRJ7usPLH/RQBQGUmqeDCxEYBlSp8UtxlnJy7I9FloSkykDiK/SmnN7tDLP7cR/nhghabLNWAbDQ2ok/GqmM+G8zRtv8c3wuuNKcKDnY8TQGCXksCnmVlLJOXL4k6VgOiaM7ACsMD6G0jGRL9T+dJ5+BtBBCRNINUGh0HmRVu4nNk2pgKfOLOeP5SrmGPhclooa/Qofo+dW17Cy3iD3mZlHoxdNWTsWmX1LrZlGMPxnHAZyctku3Tq8DL3XrXCCCWTMUIpgh6zgREYeZl+i1gKiF4WXOuC5uEGpd/JHU6j1YyaMrKLpAnXvvGNj9rDAtQ8PM9GqN3XlaUkEFVf9nLIeCy70s38/RgfAvrDDZE6fJVIJYycy/CHKruCbX31WgDXoE=
  file:
    - "app/build/outputs/apk/release/manager.apk"
    - "push/build/outputs/apk/release/xmsf_service.apk"
  on:
    tags: false
    all_branches: true